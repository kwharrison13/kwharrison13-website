---
import Base from '../layouts/Base.astro';
import garden from '../content/portfolio/ideas.json';
import sandbox from '../content/portfolio/sandbox.json';

const allTags = [...new Set(sandbox.flatMap((item: any) => item.tags))].filter(Boolean).sort();
const written = sandbox.filter((item: any) => item.status === 'Written');
const sandboxOnly = sandbox.filter((item: any) => item.status === 'Sandbox');
---

<Base title="Portfolio Ideas">
  <div class="section">
    <div class="section-header">
      <h1 class="section-title">Portfolio Ideas</h1>
      <div class="section-rule"></div>
    </div>

    <p class="intro-text">
      This is my <a href="https://maggieappleton.com/garden-history" target="_blank" rel="noopener">digital garden</a> for <em>"big important ideas"</em> that I think about often. As Charlie Munger put it: <strong>"Take a simple idea and take it seriously."</strong>
    </p>

    <!-- GARDEN -->
    <div class="subsection">
      <div class="subsection-header">
        <span class="subsection-icon">üå±</span>
        <h2 class="subsection-title">My Digital Garden</h2>
        <div class="subsection-rule"></div>
        <span class="subsection-count">{garden.length} ideas</span>
      </div>
      <div class="garden-grid">
        {garden.map((item: any, i: number) => (
          <div class="garden-item fade-up">
            <div class="garden-number">{String(i + 1).padStart(2, '0')}</div>
            <div class="garden-body">
              <div class="garden-name">{item.name}</div>
              <p class="garden-desc">{item.description}</p>
            </div>
          </div>
        ))}
      </div>
    </div>

    <!-- SANDBOX -->
    <div class="subsection">
      <div class="subsection-header">
        <span class="subsection-icon">üèñÔ∏è</span>
        <h2 class="subsection-title">My Digital Sandbox</h2>
        <div class="subsection-rule"></div>
        <span class="subsection-count">{sandbox.length} ideas</span>
      </div>
      <p class="sandbox-intro">Ideas not yet watered enough to make it to my garden ‚Äî seeds worth keeping track of.</p>

      <div class="tag-filter" id="tagFilter">
        <button class="filter-btn active" data-tag="all">All</button>
        {allTags.map((tag: any) => (
          <button class="filter-btn" data-tag={tag}>{tag}</button>
        ))}
      </div>

      {written.length > 0 && (
        <div class="sandbox-group">
          <div class="sandbox-group-label">Written</div>
          <div class="sandbox-list">
            {written.map((item: any) => (
              <div class="sandbox-item" data-tags={item.tags.join(',')}>
                <span class="sandbox-name">{item.name}</span>
                <div class="sandbox-tags">
                  {item.tags.map((tag: string) => <span class="sandbox-tag">{tag}</span>)}
                </div>
              </div>
            ))}
          </div>
        </div>
      )}

      <div class="sandbox-group">
        <div class="sandbox-group-label">In Progress</div>
        <div class="sandbox-list">
          {sandboxOnly.map((item: any) => (
            <div class="sandbox-item" data-tags={item.tags.join(',')}>
              <span class="sandbox-name">{item.name}</span>
              <div class="sandbox-tags">
                {item.tags.map((tag: string) => <span class="sandbox-tag">{tag}</span>)}
              </div>
            </div>
          ))}
        </div>
      </div>
    </div>
  </div>
</Base>

<style>
.intro-text {
  font-size: 18px;
  color: var(--ink-light);
  max-width: 640px;
  margin-bottom: 56px;
  line-height: 1.7;
}
.intro-text a { color: var(--rust); }
.intro-text strong { color: var(--ink); }
.subsection { margin-bottom: 72px; }
.subsection-header { display: flex; align-items: center; gap: 14px; margin-bottom: 32px; }
.subsection-icon { font-size: 20px; }
.subsection-title { font-family: var(--font-display); font-size: 26px; font-weight: 700; letter-spacing: -0.01em; white-space: nowrap; }
.subsection-rule { flex: 1; height: 1px; background: var(--rule); }
.subsection-count { font-family: var(--font-mono); font-size: 11px; color: var(--ink-muted); letter-spacing: 0.08em; white-space: nowrap; }
.garden-grid { display: flex; flex-direction: column; }
.garden-item { display: grid; grid-template-columns: 40px 1fr; gap: 20px; padding: 24px 0; border-bottom: 1px solid var(--rule); align-items: start; }
.garden-item:hover .garden-name { color: var(--rust); }
.garden-number { font-family: var(--font-mono); font-size: 12px; color: var(--ink-muted); padding-top: 4px; }
.garden-name { font-family: var(--font-display); font-size: 21px; font-weight: 600; letter-spacing: -0.01em; margin-bottom: 8px; transition: color 0.2s; }
.garden-desc { font-size: 15px; color: var(--ink-muted); line-height: 1.65; max-width: 680px; }
.sandbox-intro { font-size: 15px; color: var(--ink-muted); font-style: italic; margin-bottom: 24px; }
.tag-filter { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 32px; }
.filter-btn { font-family: var(--font-mono); font-size: 10px; letter-spacing: 0.1em; text-transform: uppercase; padding: 5px 12px; border: 1px solid var(--rule); background: transparent; color: var(--ink-muted); cursor: pointer; transition: all 0.15s; }
.filter-btn:hover, .filter-btn.active { background: var(--ink); color: var(--cream); border-color: var(--ink); }
.sandbox-group { margin-bottom: 32px; }
.sandbox-group-label { font-family: var(--font-mono); font-size: 10px; letter-spacing: 0.15em; text-transform: uppercase; color: var(--ink-muted); padding-bottom: 10px; border-bottom: 1px solid var(--rule); }
.sandbox-list { display: flex; flex-direction: column; }
.sandbox-item { display: flex; align-items: center; justify-content: space-between; gap: 16px; padding: 12px 0; border-bottom: 1px solid var(--rule); transition: opacity 0.2s; }
.sandbox-item.hidden { display: none; }
.sandbox-name { font-size: 16px; color: var(--ink); }
.sandbox-tags { display: flex; gap: 6px; flex-wrap: wrap; justify-content: flex-end; }
.sandbox-tag { font-family: var(--font-mono); font-size: 9px; letter-spacing: 0.08em; text-transform: uppercase; color: var(--ink-muted); border: 1px solid var(--rule); padding: 2px 7px; }
@media (max-width: 600px) {
  .sandbox-item { flex-direction: column; align-items: flex-start; gap: 6px; }
  .sandbox-tags { justify-content: flex-start; }
}
</style>

<script>
const filterBtns = document.querySelectorAll('.filter-btn');
const sandboxItems = document.querySelectorAll('.sandbox-item');
filterBtns.forEach(btn => {
  btn.addEventListener('click', () => {
    filterBtns.forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const tag = (btn as HTMLElement).getAttribute('data-tag');
    sandboxItems.forEach(item => {
      if (tag === 'all') {
        item.classList.remove('hidden');
      } else {
        const tags = item.getAttribute('data-tags') || '';
        item.classList.toggle('hidden', !tags.includes(tag!));
      }
    });
  });
});
</script>
